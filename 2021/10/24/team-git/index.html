<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="manifest" href="/manifest.json">

  
    <meta name="description" content="elegantYu的快乐小屋~">
  

  
    <meta name="keywords" content="技术,前端,学习,交流,javascript,nodejs,vue,插件,杂学,扯淡，教程，工具">
  

  
    <meta name="author" content="elegantYU">
  

  

  

  <title>关于git的几件小事 | elegantYu</title>

  

  
    <link rel="icon" href="/favicon.ico">
  

  

  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@latest/build/styles/vs2015.min.css">
<link rel="alternate" href="/atom.xml" title="elegantYu" type="application/atom+xml">
</head>
<body>
  <div class="root-container">
    <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          elegantYu
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">home</a></li>
        
          <li class="navbar-list-item"><a href="/categories">categories</a></li>
        
          <li class="navbar-list-item"><a href="/about">about</a></li>
        
      </ul>
    </div>
  </div>
</nav>

    
<!-- header container -->
<header class="header-container post">

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      <div class="post-image" style="background-image: url(https://i.loli.net/2020/06/14/2Ndt1jLzMiE3Bxy.jpg)"></div>
      <div class="post-text">
        <div class="type-wrap">
          
        </div>
        <h1 class="title-wrap">关于git的几件小事</h1>
        <h2 class="title-sub-wrap">
          <strong>elegantYU</strong>
          <span>发布于</span>
          
  <a href="javascript:;" target="_blank" rel="noopener" class="article-date">
    <time datetime="2021-10-24T09:57:10.000Z" itemprop="datePublished">2021-10-24</time>
  </a>

        </h2>
      </div>
    </div>
  

  
  

  </header>

    <!-- 文章 -->

<!-- 文章内容 -->

<div class="body-container">
  <article class="content-container article-container">
    <div class="article-content">
      
      

      <div class="article-entry">
        <h1 id="认识工作流"><a href="#认识工作流" class="headerlink" title="认识工作流"></a>认识工作流</h1><p>git工作流，即 git 仓库单人/多人操作时所遵守的一种流程模式。</p>
<p>常见的工作流分支</p>
<table>
<thead>
<tr>
<th align="left">分支</th>
<th align="left">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="left">master</td>
<td align="left">主干分支，一般用于集合所有发布版本</td>
</tr>
<tr>
<td align="left">develop/dev</td>
<td align="left">开发分支，用户集合所有在开发中的版本</td>
</tr>
<tr>
<td align="left">release</td>
<td align="left">待发布版本分支，集合当前版本所有需求</td>
</tr>
<tr>
<td align="left">feature</td>
<td align="left">每个需求需要在自己的 featrure 分支中开发</td>
</tr>
<tr>
<td align="left">hotfix</td>
<td align="left">来自发布后出现的 bug 需要从 master 拉取 hotfix 分支进行修复，修复完毕合并回 master 与 develop 分支</td>
</tr>
</tbody></table>
<h2 id="公司现有的工作流分析"><a href="#公司现有的工作流分析" class="headerlink" title="公司现有的工作流分析"></a>公司现有的工作流分析</h2><ol>
<li><p>小程序项目</p>
<p>小程序项目现有的工作流程较为明确</p>
<ul>
<li>[master] 分支负责集合发布 release 分支，堡垒环境测试通过后可直接上线</li>
<li>[release + 发布日期] 分支作为每个版本的需求集合分支，堡垒及之前的测试环境都可使用</li>
<li>[featrue] 分支暂时没有统一分支格式，单个需求开发，开发完毕后合并到 release 分支</li>
<li>[hotfix] 分支暂时没有统一分支格式</li>
</ul>
</li>
<li><p>h5 项目</p>
<p>h5 页面项目工作流理解简单，只有 master 和 feature 的分支配合</p>
</li>
<li><p>更简单的个人负责的项目</p>
<p>一条 master 分支搞定一切</p>
</li>
</ol>
<h1 id="多人合作中应注意到的事情"><a href="#多人合作中应注意到的事情" class="headerlink" title="多人合作中应注意到的事情"></a>多人合作中应注意到的事情</h1><p>多人项目做多了，会暴露很多问题，有些人可能注意到但工作完就忘记，有些是埋头开发不管其他</p>
<h2 id="branch-命名"><a href="#branch-命名" class="headerlink" title="branch 命名"></a>branch 命名</h2><p>  这里主要提及的就是 feature 和 hotfix 的分支命名，由于缺少命名规范，大家对命名都有自己的理解，eg: 弱引导需求</p>
<pre><code>    1. feat-weakGuide
    2. feature-weakGuide
    3. feat/weakGuide
    4. feat_weakGuide 
    5. weak-guide</code></pre><p>  个人目前使用 1 的格式，前前东家内的格式为<code>[分支类型]-[发布版本]-[功能名]</code>进行约束，查看 branch list 会直观查询到自己寻找的分支</p>
<pre><code>    feat-0930-xxxx
    feat-1028-weakGuide
    feat-1030-yyyy</code></pre><p>  当然，搭配成团队适合，大家都能接受的规范才是好规范</p>
<h2 id="commit-规范"><a href="#commit-规范" class="headerlink" title="commit 规范"></a>commit 规范</h2><p>  建议直接看阮一峰的 <a href="https://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html" target="_blank" rel="noopener">commit message 与 change log</a>，这里简单介绍下 commit message 的 header 部分</p>
<p>  header 就是我们常用的 commitlog，<code>git commit -m &#39;这里是 header&#39;</code></p>
<p>  header 规范由三个部分组成 <code>[type]([scope]): [subject]</code> ，例如</p>
<pre><code class="bash">  git commit -m &#39;feat(robShare): 新增任意行活动入口;样式优化;bug修复&#39;</code></pre>
<ul>
<li><p>type 类型</p>
<p>一般为以下几种类型</p>
<table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">feat</td>
<td align="left">新功能/需求(feature)</td>
</tr>
<tr>
<td align="left">fix</td>
<td align="left">修复了 bug</td>
</tr>
<tr>
<td align="left">style</td>
<td align="left">样式调整，不影响代码逻辑</td>
</tr>
<tr>
<td align="left">pref</td>
<td align="left">优化，可能是代码格式化，或代码优化</td>
</tr>
<tr>
<td align="left">docs</td>
<td align="left">文档</td>
</tr>
<tr>
<td align="left">…</td>
<td align="left">…</td>
</tr>
</tbody></table>
</li>
<li><p>scope 范围</p>
<p>这是个可选项，用于方便代码审查时直观了解到这个 commit 的作用范围</p>
<p>比如，这次需求主要在 robShare 页面里的修改，但只看 subject 不能直接了解到是哪个文件夹/页面，这时， scope 就是很有必要的</p>
<pre><code>fix(common/util): xxx工具函数调整</code></pre></li>
<li><p>subject</p>
<p>这就没什么具体的规范了，已直观、概括为主，可用分号隔离不同的描述</p>
</li>
</ul>
<h2 id="commit-message-的客户端工具"><a href="#commit-message-的客户端工具" class="headerlink" title="commit message 的客户端工具"></a>commit message 的客户端工具</h2><p>  网上有很多对于提交信息的约束工具，我的个人项目一般都是用 <code>husky + commitlint</code></p>
<ul>
<li><a href="https://github.com/typicode/husky" target="_blank" rel="noopener">husky</a> 是一个 githook工具，在 package.json 中配置 git hooks 用于处理各个阶段的问题</li>
<li><a href="https://github.com/conventional-changelog/commitlint" target="_blank" rel="noopener">commitlint</a> 用于 commit message 的格式校验</li>
</ul>
<p>  简单配置如下：</p>
<p>  package.json</p>
<pre><code class="json">  &quot;husky&quot;: {
        &quot;hooks&quot;: {
            &quot;commit-msg&quot;: &quot;commitlint --config .commitlintrc.js -E HUSKY_GIT_PARAMS&quot;
        }
    }</code></pre>
<p>  commitlintrc.js</p>
<pre><code class="js">  module.exports = {
    extends: [&#39;@commitlint/config-conventional&#39;],
    rules: {
      &#39;type-enum&#39;: [
        2,
        &#39;always&#39;,
        [&#39;build&#39;, &#39;ci&#39;, &#39;chore&#39;, &#39;feat&#39;, &#39;docs&#39;, &#39;fix&#39;, &#39;perf&#39;, &#39;refactor&#39;, &#39;style&#39;, &#39;notes&#39;, &#39;wip&#39;, &#39;version&#39;],
      ],
    },
  };</code></pre>
<h1 id="git操作-常见-可能-会遇到的问题"><a href="#git操作-常见-可能-会遇到的问题" class="headerlink" title="git操作 常见/可能 会遇到的问题"></a>git操作 常见/可能 会遇到的问题</h1><ol>
<li><p>git add 后想撤销</p>
<p> 编辑器的 git 控制台可以操作撤回，或者使用 <code>git reset HEAD</code>命令</p>
</li>
<li><p>git commit 后想撤回</p>
<ul>
<li>找到想撤回的 commitid，获取其前一版本的 commitid</li>
<li><code>git reset --hard &lt;commitid&gt;</code></li>
</ul>
</li>
<li><p>git commmit 后发现开发的分支错了</p>
<ul>
<li>获取这次修改提交的 commitid</li>
<li>切换到需要正确的分支</li>
<li><code>git cherry-pick &lt;commitid&gt;</code></li>
<li>可以转移多个提交 <code>git cherry-pick &lt;commitid A&gt; &lt;commitid B&gt;</code></li>
</ul>
</li>
<li><p>压缩本地开发的 commit</p>
<p>本地开发可能由于各种情况，会出现一个分支有多个无用的 commit</p>
<pre><code class="bash"> hash a
   wip: 没写完
 hash b
   wip: 还没写完
 hash c
   wip: 就快写完了</code></pre>
<p>如果当前分支直接合并在 release 上，会使得分支树 log 很多，并且代码审核时很费劲，尽量保证每次合并分支，只有一次有效 commit。</p>
<p>所以我们需要对本地的 commmit 进行压缩</p>
<pre><code class="bash"> git rebase -i &lt;commitid c&gt;

 ----- 会出现以下场景

 pick [hash a] wip: 没写完
 pick [hash b] wip: 还没写完
 pick [hash c] wip: 就快写完了

 ----- 除了顶部第一个 commit 不修改之外，剩下的 pick 改为 squash | s

 pick [hash a] wip: 没写完
 s [hash b] wip: 还没写完
 s [hash c] wip: 就快写完了

 ----- 保存退出后，需要填写压缩后的 commit message，修改后保存退出</code></pre>
<p>如此就合并了许多无特殊意义的 commit</p>
</li>
<li><p>压缩后后悔了，怎么撤销</p>
<p> 这里要了解下 <code>git reflog</code> 可以查看 git 的所有操作记录，其内所有的 commitid 都是可以进行回滚的</p>
</li>
<li><p>分支重命名</p>
<p> 在需要改名的分支下 <code>git branch -m &lt;newname&gt;</code></p>
</li>
<li><p>修改 commit message</p>
<p> <code>git commit --amend</code></p>
</li>
</ol>
<p>…</p>
<p>以上都是为了方便团队协同和提升个人开发规范性，各种命令若是有 GUI 可以替代的话，可以选择自己更方便的操作。</p>

      </div>

      <div class="article-footer">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">#git</a></li></ul>
      </div>

      <div class="article-navs">
        
<nav class="card-container card-article-nav">
  <div class="card-wrap">
    
    
      <div id="article-nav-older" class="card-item">
        <article>
          
          <a class="card-link article-nav-link" href="/2021/09/05/first-in-ctrip/"></a>
          <strong class="article-nav-caption">Older</strong>
          <p class="article-nav-title">
            
              里程
            
          </p>
        </article>
      </div>
    
  </div>
</nav>

      </div>
      
      

  
  
  <div class="valine-container">
    <div id="valine_thread" class="valine-thread"></div>
  </div>
  

  
  


    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
    <p>&copy; 2022 <a href="/" target="_blank">elegantYU</a></p>

    
      <p id="hitokoto"></p>
      <script src="https://v1.hitokoto.cn/?c=d&amp;encode=js&select=%23hitokoto" defer></script>
    

    

    <!-- <p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> Theme - <a href="https://github.com/miiiku/flex-block" target="_blank">flex-block</a></p> -->
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <div class="hiddenBox" style="display: none;">
      <span id="busuanzi_value_site_uv"></span>位道友拜访过
      <span id="busuanzi_value_site_pv"></span>次流连忘返
      <span id="busuanzi_value_page_pv"></span>次留名
      <span id="busuanzi_container_site_uv"></span>
      <span id="busuanzi_container_site_pv"></span>
      <span id="busuanzi_container_page_pv"></span>
    </div>
  </div>
</footer>
  </div>

  
  
<!-- valine 评论 start -->
<script type="text/javascript" src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script type="text/javascript" src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script type="text/javascript">
  new Valine({
    el: "#valine_thread",
    appId: "5xXAw8mGSxsiAVvItnDTlc1Q-gzGzoHsz",
    appKey: "izanFwv9WmbM99bQQKMDt6jj",
    avatar: "elegantYu",
    placeholder: "我卢本伟！没有开挂！",
    notify: true,
    visitor: true,
    pageSize: 10,
  });
</script>
<!-- valine 评论 end -->



  <!-- aplayer 音频 start -->
  <link rel="stylesheet" href="/lib/APlayer.min.css">
  <script src="/lib/APlayer.min.js"></script>
  <script type="text/javascript">
    const aplayer = document.querySelectorAll(".aplayer");
    aplayer && initaplayer(aplayer);
    function initaplayer(els) {
      let elsArr = Array.from(els);
      elsArr.forEach(el => {
        new APlayer({
          container: el,
          audio: { ...el.dataset },
          theme: "#b7daff",
          lrcType: 3,
          autoplay: false,
          loop: false,
          mutex: true,
        });
      });
    }
  </script>
  <!-- aplayer 音频 end -->
  

<!-- dplayer 视频 start -->
<link rel="stylesheet" href="/lib/DPlayer.min.css">
<script src="/lib/DPlayer.min.js"></script>
<script type="text/javascript">
  const dplayer = document.querySelectorAll(".dplayer");
  dplayer && initDPlayer(dplayer);
  function initDPlayer(els) {
    let elsArr = Array.from(els);
    elsArr.forEach(el => {
      let url = el.dataset.url;
      let cover = el.dataset.cover;
      new DPlayer({
        container: el,
        video: { url: url, pic: cover },
        theme: "#b7daff",
        autoplay: false,
        loop: false,
        mutex: true,
      });
    });
  }
</script>
<!-- dplayer 视频 end -->


<!-- waterfall 瀑布流 start -->
<script src="/lib/waterfall.min.js"></script>
<script type="text/javascript">

const waterfalls = document.querySelectorAll(".waterfall-container");

if (waterfalls && waterfalls.length > 0) {
  waterfalls.forEach((waterfall, index) => {
    let cls = "waterfall-container-" + index;
    waterfall.classList.add(cls);
    initWaterfall(cls, waterfall);
  });
}

function initWaterfall(selector, el) {
  const options = {};
  if (Object.keys(el.dataset).length > 0) {
    for (let k in el.dataset) {
      options[k] = el.dataset[k];
    }
  }
  waterfall(`.${selector}`, options);
}
</script>
<!-- waterfall 瀑布流 end -->


  <!-- zoom start -->
  <script src="/lib/zoom.min.js"></script>
  <script type="text/javascript">
    document.querySelector(".article-content") && zoom(".article-content");
  </script>
  <!-- zoom end -->
  



  


  <!-- Google Analytics START -->
  <script type="text/javascript">
    (function (i, s, o, g, r, a, m) {
      if (window.location.hostname === "localhost" || window.location.hostname.startsWith("192.168")) {
        return console.log("本地调试");
      }
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
  
    ga('create', 'UA-165699409-1', 'auto');
    ga('send', 'pageview');
  </script>
  <!-- Google Analytics End -->

  


  



<script src="/js/script.js"></script>

<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@latest/build/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
  
  <!-- 尾部用户自定义相关内容 -->

<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>