<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="manifest" href="/manifest.json">

  
    <meta name="description" content="elegantYuçš„å¿«ä¹å°å±‹~">
  

  
    <meta name="keywords" content="æŠ€æœ¯,å‰ç«¯,å­¦ä¹ ,äº¤æµ,javascript,nodejs,vue,æ’ä»¶,æ‚å­¦,æ‰¯æ·¡ï¼Œæ•™ç¨‹ï¼Œå·¥å…·">
  

  
    <meta name="author" content="elegantYU">
  

  

  

  <title>H5é€šç”¨åŠŸèƒ½ç‚¹æ±‡æ€» | elegantYu</title>

  

  
    <link rel="icon" href="/favicon.ico">
  

  

  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@latest/build/styles/vs2015.min.css">
<link rel="alternate" href="/atom.xml" title="elegantYu" type="application/atom+xml">
</head>
<body>
  <div class="root-container">
    <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          elegantYu
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">home</a></li>
        
          <li class="navbar-list-item"><a href="/categories">categories</a></li>
        
          <li class="navbar-list-item"><a href="/about">about</a></li>
        
      </ul>
    </div>
  </div>
</nav>

    
<!-- header container -->
<header class="header-container post">

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      <div class="post-image" style="background-image: url(https://i.loli.net/2020/04/06/bAzhi5pl8nBxOqQ.jpg)"></div>
      <div class="post-text">
        <div class="type-wrap">
          <a class="article-category-link" href="/categories/%E5%9F%BA%E7%A1%80/">åŸºç¡€</a>
        </div>
        <h1 class="title-wrap">H5é€šç”¨åŠŸèƒ½ç‚¹æ±‡æ€»</h1>
        <h2 class="title-sub-wrap">
          <strong>elegantYU</strong>
          <span>å‘å¸ƒäº</span>
          
  <a href="javascript:;" target="_blank" rel="noopener" class="article-date">
    <time datetime="2019-09-02T22:26:30.000Z" itemprop="datePublished">2019-09-02</time>
  </a>

        </h2>
      </div>
    </div>
  

  
  

  </header>

    <!-- æ–‡ç«  -->

<!-- æ–‡ç« å†…å®¹ -->

<div class="body-container">
  <article class="content-container article-container">
    <div class="article-content">
      
      

      <div class="article-entry">
        <blockquote>
<p>ä½œä¸ºä¸€åæœ‰æ“å®ˆçš„ç¨‹åºå‘˜ï¼Œé„™äººï¼Œåªå‘å¹²è´§ï¼</p>
</blockquote>
<blockquote>
<p>æ­¤ç¯‡æ–‡ç« ä½œä¸º h5 å‰ç«¯è·¯ä¸Šçš„åŠŸèƒ½ç‚¹ã€å·¥å…·æ€»ç»“ï¼›å¦‚æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¯·åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„èº«å½±</p>
</blockquote>
<a id="more"></a>

<p>è¿åšä¸‰ä¸ª h5 é¡¹ç›®ï¼Œæˆ–å¤šæˆ–å°‘ç§¯ç´¯ä¸€ç‚¹å¼€å‘çš„ç»éªŒï¼Œæ­¤ç¯‡æ–‡ç« ä¸€æ˜¯è®°å½•ï¼ŒäºŒä¸ºåˆ†äº«ã€‚</p>
<p>å¼€æ•´ï¼</p>
<h2 id="åŸºç¡€ç¯å¢ƒ"><a href="#åŸºç¡€ç¯å¢ƒ" class="headerlink" title="åŸºç¡€ç¯å¢ƒ"></a>åŸºç¡€ç¯å¢ƒ</h2><p>ä¸‰æ¬¡é¡¹ç›®çš†ä½¿ç”¨ vue æ¡†æ¶å¼€å‘ï¼Œä½¿ç”¨ vue-cli3.x ç”Ÿæˆé¡¹ç›®ä¸»ä½“å·²æ˜¯ç›¸å½“ç†Ÿç¨”ï¼Œ<u><a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener">vue-cli ä¼ é€é—¨</a></u>ã€‚</p>
<p>ä½¿ç”¨ axios è¯·æ±‚åº“ï¼Œä¹Ÿå¯è‡ªè¡Œé€‰æ‹©é¡ºæ‰‹çš„ä½¿ç”¨ã€‚</p>
<h2 id="å¾®ä¿¡-sdk-çš„å†æ¬¡å°è£…"><a href="#å¾®ä¿¡-sdk-çš„å†æ¬¡å°è£…" class="headerlink" title="å¾®ä¿¡ sdk çš„å†æ¬¡å°è£…"></a>å¾®ä¿¡ sdk çš„å†æ¬¡å°è£…</h2><p>å¾®ä¿¡å®˜æ–¹æä¾›ä¸€ä¸ª jsbridge è„šæœ¬ï¼Œèƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„ä½¿ç”¨è®¾å¤‡çš„ä¸€äº›åŠŸèƒ½åŠå¾®ä¿¡æœ¬èº«æä¾›çš„åŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦åšçš„æ˜¯åœ¨é¡¹ç›®ä¸­æ›´å¥½çš„è°ƒç”¨å®ƒã€‚</p>
<ul>
<li><p>åœ¨<code>public/index.html</code>æ¨¡ç‰ˆ html é‡Œçš„ head ä¸­åŠ å…¥ wxsdk(<u><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1421141115" target="_blank" rel="noopener">ä¼ é€é—¨</a></u>)ï¼Œæˆ–ç›´æ¥å¤åˆ¶æ­¤æ¡<code>http://res.wx.qq.com/open/js/jweixin-1.4.0.js</code>(å¾®ä¿¡ç›®å‰æœ€æ–°ç‰ˆæœ¬ js)</p>
</li>
<li><p>åœ¨<code>src</code>ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>utils</code>æ–‡ä»¶å¤¹å†…åˆ›å»º<code>wxsdk.js</code>ï¼Œåœ¨å…¶ä¸­åŠ ä¸Š</p>
</li>
</ul>
<pre><code class="javascript">import axios from &quot;axios&quot;;

const wxsdk = {
  init(url) {
    // é¡¾åæ€ä¹‰ï¼Œç”¨äºåˆå§‹åŒ–wxconfigçš„æ–¹æ³•
    return new Promise(resolve =&gt; {
      axios
        .get(&quot;è¯·æ±‚å¾®ä¿¡configçš„åç«¯æ¥å£&quot;, { params: { url } })
        .then(({ appId, timestamp, nonceStr, signature }) =&gt; {
          wx.config({
            debug: false, // åé¢å¯ä»¥ç”¨äºè°ƒè¯•configæ˜¯å¦é…ç½®æˆåŠŸ
            appId,
            timestamp,
            nonceStr,
            signature,
            jsApiList: [
              &quot;chooseImage&quot;,
              &quot;uploadImage&quot;,
              &quot;getLocalImgData&quot;,
              &quot;updateAppMessageShareData&quot;,
              &quot;updateTimelineShareData&quot;
            ] // åœ¨æ­¤æ³¨å†Œä½ éœ€è¦ä½¿ç”¨çš„api
          });
          resolve(); //  é…ç½®å®Œæˆçš„promiseå›è°ƒ
        });
    });
  }
};

export default wxsdk;</code></pre>
<ul>
<li>ä¸‹é¢æŠŠåˆå§‹åŒ–æ–¹æ³•æ”¾å…¥å…¨å±€çš„è·¯ç”±å®ˆå«ä¸­ï¼Œä½¿ç”¨æˆ·åœ¨æ¯ä¸ªé¡µé¢æ‰“å¼€æ—¶éƒ½æ³¨å†Œä¸€æ¬¡ã€‚</li>
</ul>
<pre><code class="javascript">// router.jsä¸­
import Vue from &#39;vue&#39;
import Router from &#39;vue-router&#39;
import wxsdk from &#39;../utils/wxsdk&#39;

Vue.use(Router)

const router = new Router({
    //  æ²¡çœ‹é”™ï¼Œä½¿ç”¨çš„æ˜¯hashï¼Œ
    //  ä½¿ç”¨hashæ˜¯å› ä¸ºæ–¹ä¾¿åç«¯ç›´æ¥ä½¿ç”¨é“¾æ¥è¿›è¡Œå…¶ä»–çš„å¸¦å‚æ“ä½œ
    //  åŒæ—¶ï¼Œä¹Ÿé¿å…äº†åœ¨nginxä¸­éƒ¨ç½²æ—¶å¯¹å‰ç«¯è·¯ç”±çš„æ“æ§
    mode: &#39;hash&#39;,
    routes: [...]
})

router.afterEach((to, from, next) =&gt; {
    // æ­¤å¤„è¾ƒä¸ºå…³é”®ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å•é¡µåº”ç”¨ï¼Œå†…éƒ¨è·¯ç”±çš†ä¸ºè™šæ‹Ÿè·¯ç”±ï¼Œ
    // å¹¶ä¸”æ˜¯hashæ¨¡å¼ï¼Œéœ€è¦è·å– # å‰çš„è·¯ç”±ä½œä¸ºè¯·æ±‚è·¯å¾„
    wxsdk.init(location.href.split(&#39;#&#39;)[0])
})

export default router</code></pre>
<ul>
<li>åŠ å…¥ä¸€ä¸ªå°è£…ä¸Šä¼ æœ¬åœ°å›¾ç‰‡æ–¹æ³•ä½œä¸ºä¾‹å­</li>
</ul>
<pre><code class="js">chooseImage (count) {
    return new Promise(resolve =&gt; {
      wx.ready(() =&gt; {
        wx.chooseImage({
          count, //  ç”¨äºæ§åˆ¶ä¸Šä¼ å›¾ç‰‡çš„æ•°é‡
          sizeType: [&#39;original&#39;, &#39;compressed&#39;],
          sourceType: [&#39;album&#39;, &#39;camera&#39;],
          success: ({ localIds }) =&gt; {
            resolve(localIds)
          }
        })
      })
    })
},</code></pre>
<ul>
<li>è‹¥é¡¹ç›®ä¸­æœ‰éœ€è¦åˆ¤æ–­å¾®ä¿¡çš„ js æ˜¯å¦åŠ è½½å®Œæ¯•ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢æ–¹æ³•</li>
</ul>
<pre><code class="javascript">// wxsdk.jsä¸­
const wxsdk = {
    ...,
    check (cb) {
      if (typeof WeixinJSBridge === &#39;object&#39; &amp;&amp; typeof WeixinJSBridge.invoke === &#39;function&#39;) {
        cb()
      } else {
        if (document.addEventListener) {
          document.addEventListener(&#39;WeixinJSBridgeReady&#39;, cb, false)
        } else if (document.attachEvent) {
          document.attachEvent(&#39;WeixinJSBridgeReady&#39;, cb)
          document.attachEvent(&#39;onWeixinJSBridgeReady&#39;, cb)
        }
      }
    },
}</code></pre>
<ul>
<li>å¯ä»¥åœ¨é¡µé¢çš„<code>mounted</code>å‘¨æœŸä¸­å¼•å…¥</li>
</ul>
<pre><code class="vue">&lt;script&gt;
export default {
  mounted() {
    this.$wxsdk.check(() =&gt; {
      console.log(&quot;å¾®ä¿¡jsåŠ è½½å®Œæ¯•,è¿›å…¥é¡µé¢&quot;);
    });
  }
};
&lt;/script&gt;</code></pre>
<ul>
<li>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å¯¹ wxsdk çš„ä½¿ç”¨ï¼Œå¯ä»¥åœ¨<code>main.js</code>ä¸­å°†æ­¤å¯¹è±¡æŒ‚è½½åˆ° vue.prototype ä¸Š</li>
</ul>
<pre><code class="js">import wxsdk from &quot;./utils/wxsdk&quot;;

Vue.prototype.$wxsdk = wxsdk;</code></pre>
<p>å¾®ä¿¡ jssdk çš„å°è£…ä½¿ç”¨åŸºæœ¬å®Œæˆã€‚</p>
<h2 id="é¡µé¢é€‚é…"><a href="#é¡µé¢é€‚é…" class="headerlink" title="é¡µé¢é€‚é…"></a>é¡µé¢é€‚é…</h2><p>æˆ‘ä½¿ç”¨çš„æ˜¯ rem å•ä½å¸ƒå±€ï¼Œæ ¹æ®è®¾é…çš„å±å¹•å®½åº¦ä¸è®¾è®¡ç¨¿çš„å®½åº¦æ¯”è®¡ç®—å‡ºæ ¹å…ƒç´ çš„åƒç´ å¤§å°ï¼Œä»è€Œä½¿ä¸€å¼ è®¾è®¡å›¾é€‚é…ä¸åŒçš„æ‰‹æœºå±å¹•</p>
<pre><code class="js">// utils/util.jsä¸­

const deviceRem = size =&gt; {
  const docEl = document.documentElement;
  const clientWidth = docEl.clientWidth;
  const reSize = () =&gt;
    (docEl.style.fontSize =
      clientWidth &gt;= size ? &quot;100px&quot; : 100 * (clientWidth / size) + &quot;px&quot;);
  document.addEventListener(&quot;DOMContentLoaded&quot;, reSize, false);
};
deviceRem(1125);</code></pre>
<h2 id="ç¬¬ä¸‰æ–¹å­—ä½“åŒ…"><a href="#ç¬¬ä¸‰æ–¹å­—ä½“åŒ…" class="headerlink" title="ç¬¬ä¸‰æ–¹å­—ä½“åŒ…"></a>ç¬¬ä¸‰æ–¹å­—ä½“åŒ…</h2><p>æ ¹æ® h5 çš„ä¸åŒä¸šåŠ¡ç‰¹ç‚¹ï¼Œå¯èƒ½éœ€è¦å¼•å…¥å„ç§ä¸ªæ ·çš„å­—ä½“åŒ…ï¼Œæ¯”å¦‚æˆ‘çš„ç¬¬ä¸€ä¸ª h5 å°±ä½¿ç”¨äº†<code>ç«™é…·å¿«ä¹ä½“xxx</code>çš„å­—ä½“åŒ…</p>
<pre><code class="scss">@font-face {
  font-family: &quot;happyFonts&quot;;
  src: url(&quot;../fonts/ç«™é…·å¿«ä¹ä½“2016ä¿®è®¢ç‰ˆ.ttf&quot;);
  font-weight: normal;
  font-style: normal;
}

body {
  font-family: &quot;happyFonts&quot;;
}</code></pre>
<p>å¼•å…¥åï¼Œæ‰“åŒ…åˆ°çº¿ä¸Šç¯å¢ƒæµ‹è¯•å‘ç°ï¼Œå³ä½¿å­—ä½“åŒ…ç”¨<code>font-spider</code>ç­›é€‰ä¸€éï¼Œå¯çœŸæœºä¸Šæ‰“å¼€æˆ–å¤šæˆ–å°‘ä¼šå‡ºç°å­—ä½“åŠ è½½è¿‡æ…¢ï¼Œå¯¼è‡´æ–‡å­—åŒºåŸŸç©ºç™½ä¸€æ®µæ—¶é—´å†å‡ºç°ï¼Œæˆ–è€…å…ˆå‡ºç°ç³»ç»Ÿé»˜è®¤å­—ä½“ï¼Œä¹‹åå†çªç„¶å‡ºç°å­—ä½“åŒ…å­—ä½“ã€‚</p>
<p>è¿™ç§ä½“éªŒâ€¦å¾ˆéš¾å—å•Š!</p>
<p>æ‰€ä»¥æˆ‘ä»¬æ€¥éœ€ä¸€ä¸ªèƒ½å¤Ÿç›‘å¬ç¬¬ä¸‰æ–¹å­—ä½“åŒ…æ˜¯å¦åŠ è½½å®Œæˆçš„æ–¹æ³•ã€‚</p>
<p>æŠ“è€³æŒ è…®ï¼Œæ¶èƒ¸é¡¿è¶³ä¹‹ä¸‹ï¼Œç»ˆäºæ‰¾åˆ°ä¸€ä¸ªç¥å™¨ <u><a href="https://github.com/bramstein/fontfaceobserver" target="_blank" rel="noopener">Font Face Observer</a></u>!!!</p>
<p>å¦‚åŒæè¿°çš„ä¸€èˆ¬ï¼Œå®ƒæä¾›ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼Œå­—ä½“åŠ è½½æˆåŠŸæˆ–å¤±è´¥ï¼Œé¡µé¢å¯ä»¥åœ¨å…¶å›è°ƒå†…å†³å®šæ˜¯å¦å‡ºç°ã€‚</p>
<pre><code class="js">import Font from &quot;fontfaceobserver&quot;;

export default {
  mounted() {
    const font = new Font(&quot;happyFonts&quot;);
    font.load().then(
      () =&gt; {
        console.log(&quot;å­—ä½“åŠ è½½å®Œæˆ&quot;);
        this.$router.replace({ name: &quot;start&quot; });
      },
      () =&gt; {
        console.log(&quot;å­—ä½“åŠ è½½å¤±è´¥&quot;);
        this.$router.replace({ name: &quot;start&quot; });
      }
    );
  }
};</code></pre>
<h2 id="BGM"><a href="#BGM" class="headerlink" title="BGM!"></a>BGM!</h2><p>å¤§éƒ¨åˆ†æ´»åŠ¨ h5 å°‘ä¸äº†ä¼šç”¨ä¸Š bgmï¼Œå»ºè®® bgm ä½¿ç”¨æŸä¸€æ®µæˆ–å‡ æ®µå¯ä»¥å¾ªç¯æ’­æ”¾çš„éŸ³é¢‘ï¼Œè¶ŠçŸ­è¶Šå¥½(å ç”¨åŠ è½½æ—¶é—´å’ŒæœåŠ¡å™¨èµ„æº)ã€‚</p>
<p>â€œéŸ³é¢‘æ–‡ä»¶å¤ªé•¿äº†ï¼Œæˆ‘åªéœ€è¦å…¶ä¸­ä¸€å°æ®µæ€ä¹ˆåŠâ€ï¼Œæˆ‘ç»™å‡ºçš„æ–¹æ³•æ˜¯ï¼š<code>æ‰¾ä¸€ä¸ªä¼šå‰ªéŸ³ä¹çš„æ¼‚äº®å¦¹å­ï¼Œå˜¿å˜¿å˜¿(å’½å£æ°´)</code>ã€‚</p>
<p>æˆ–è€…<u><a href="https://www.zhihu.com/question/19907593" target="_blank" rel="noopener">ç‚¹å‡»æ­¤å¤„</a></u></p>
<p>å¥½äº†ï¼Œç”±äº h5 ä¸­çš„ bgm å ç”¨äº†å’Œå­—ä½“åŒ…å·®ä¸å¤šçš„å¤§å°ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ªèƒ½å¤Ÿåˆ¤æ–­éŸ³é¢‘æ–‡ä»¶åŠ è½½å®Œæˆçš„äº‹ä»¶ã€‚</p>
<p>ä¸‹é¢æ˜¯ audio ç›¸å…³çš„äº‹ä»¶</p>
<pre><code class="html">&lt;body&gt;
  &lt;audio id=&quot;music&quot; src=&quot;&quot; loop=&quot;loop&quot;&gt;&lt;/audio&gt;
  &lt;script&gt;
    /**
     * @func play æ’­æ”¾ å¯åˆ¤æ–­éŸ³é¢‘æ˜¯å¦æ­£åœ¨æ’­æ”¾
     * @func pause æš‚åœ å¯åˆ¤æ–­éŸ³é¢‘æ˜¯å¦æš‚åœ
     * @funcs  ä¸€ä¸‹äº‹ä»¶æ˜¯éŸ³é¢‘åœ¨åŠ è½½è¿‡ç¨‹ä¸­ä¾æ¬¡è§¦å‘çš„
     * loadstart =&gt; durationchange =&gt; loadeddata =&gt; progress =&gt; canplay =&gt; canplaythrough
     */
    const audio = document.getElementById(&quot;music&quot;);
    audio.oncanplay = () =&gt; {
      console.log(&quot;éŸ³ä¹å¯ä»¥æ’­æ”¾ï¼Œåšä½ æƒ³åšçš„å§&quot;);
    };
  &lt;/script&gt;
&lt;/body&gt;</code></pre>
<p>æ­£åœ¨æˆ‘å¿—å¾—æ„æ»¡æ‰“å¼€æµ‹è¯•é“¾æ¥æ—¶ï¼Œå‘ç°æ— è®ºå¦‚ä½•ç‚¹å‡»æ’­æ”¾éƒ½æ²¡æœ‰éŸ³ä¹å£°éŸ³ï¼ğŸ˜±</p>
<p>ç€æ€¥å¿™æ…Œæ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·è°ƒè¯•åå‘ç°ï¼Œæˆ‘çš„éŸ³ä¹åœ°å€æ‰¾ä¸åˆ°èµ„æºï¼Œè¿™æ˜¯ä¸ºä½•ï¼Ÿåˆ†æ˜å°±æ”¾åœ¨<code>src/assets/music</code>ä¸­å•Šï¼Œæ‰¾ä¸åˆ°èµ„æºâ€¦éš¾ä¸æˆï¼</p>
<p>å¿ƒå¤´ä¸€ç‚¹çµå…‰ä¹ç°ï¼Œå½“å³æ‰“å¼€<u><a href="https://vue-loader.vuejs.org/zh/options.html#transformasseturls" target="_blank" rel="noopener">vue-cli</a></u>ï¼Œæ€¥æ€¥æœ›å»</p>
<pre><code class="js">{
  video: [&#39;src&#39;, &#39;poster&#39;],
  source: &#39;src&#39;,
  img: &#39;src&#39;,
  image: [&#39;xlink:href&#39;, &#39;href&#39;],
  use: [&#39;xlink:href&#39;, &#39;href&#39;]
}</code></pre>
<p>æœç„¶ä¸å‡ºæ‰€æ–™ï¼Œvue-cli çš„ loader é…ç½®é»˜è®¤æ²¡æœ‰ audio çš„é…ç½®ï¼è‡³æ­¤ï¼Œæƒ…ç»ªå†æ¬¡æ¢å¤å¹³é™ï¼Œæ‰“å¼€<code>vue.config.js</code>ï¼Œç¼“ç¼“ä¹¦å†™å‡ è¡Œä»£ç </p>
<pre><code class="js">module.exports = {
  assetsDir: &quot;static&quot;,
  chainWebpack: config =&gt; {
    config.module
      .rule(&quot;vue&quot;)
      .use(&quot;vue-loader&quot;)
      .loader(&quot;vue-loader&quot;)
      .tap(options =&gt; {
        options.transformAssetUrls = {
          audio: &quot;src&quot;
        };
        return options;
      });
  }
};</code></pre>
<p>é‡æ–°æ‰“åŒ…ï¼Œç‚¹å¼€<code>dist</code>æ–‡ä»¶å¤¹ï¼Œ<code>static/media/xxx.mp3</code>å·²å®‰ç¨³çš„è¿›å…¥å…¶ä¸­ï¼Œå¾å¿ƒç”šæ…°ã€‚</p>
<h2 id="html2canvas"><a href="#html2canvas" class="headerlink" title="html2canvas"></a>html2canvas</h2><p>h5 çš„æœ€åæ¨å¹¿ï¼ŒåŒæ ·å°‘ä¸äº†çš„ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯ï¼Œç”Ÿæˆå›¾ç‰‡ã€‚</p>
<p>å¯¹äºç”Ÿæˆå›¾ç‰‡ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ¨¡å—å¯ä¾›ä½¿ç”¨<code>html2canvas</code>å’Œ<code>dom-to-image</code>ï¼Œä¸¤ä¸ªæ¨¡å—çš„ä½¿ç”¨æ–¹æ³•éƒ½å¾ˆç®€å•ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ html2canvas.</p>
<p>éšä¹‹è€Œæ¥çš„å°±æ˜¯è€ç”Ÿå¸¸è°ˆçš„ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€æ˜¯å›¾ç‰‡è·¨åŸŸé—®é¢˜ï¼ŒäºŒæ˜¯ç”Ÿæˆå›¾ç‰‡æ¸…æ™°åº¦ä¼˜åŒ–ã€‚</p>
<ul>
<li><p>å›¾ç‰‡è·¨åŸŸ</p>
<p>å¯ç”¨ html2canvas ä¸­çš„<code>{ useCORS: true }</code>é…ç½®ï¼Œå³å¯æ¸²æŸ“ cdn çš„å›¾ç‰‡å’Œæœ¬åœ°å›¾ç‰‡ã€‚</p>
<p>è‹¥æœ‰å…¶ä»–æ¥æºå›¾ç‰‡(æ¯”å¦‚å¾®ä¿¡ç”¨æˆ·å¤´åƒ)ï¼Œè¦ä¹ˆèµ°æ¥å£è½¬åŒ–ä¸‹å›¾ç‰‡é“¾æ¥ï¼Œè¦ä¹ˆå°†å›¾ç‰‡è½¬æˆ base64 æ ¼å¼å†è¡Œæ¸²æŸ“å³å¯ã€‚</p>
</li>
<li><p>æ¸…æ™°åº¦ä¼˜åŒ–</p>
<ol>
<li>å°†é€‰åŒº dom çš„å¸ƒå±€å•ä½æ”¹ä¸º px åƒç´ </li>
<li>ä½¿ç”¨<code>{ scale: 2 }</code>å°† canvas çš„å®½é«˜æ‰©å¤§ä¸ºåŸæœ¬ dom çš„ä¸¤å€ï¼Œæˆ–è®¾ç½®ä¸º devicePixelRatio å€ï¼Œæœ€åå°†ç”Ÿæˆå›¾ç‰‡çš„å¤§å°è®¾ç½®ä¸ºåŸå…ˆ dom å¤§å°</li>
<li>å¯ä»¥ä½¿ç”¨ css ç»˜åˆ¶çš„æ ·å¼ï¼Œå°½é‡ä¸è¦ä½¿ç”¨å›¾ç‰‡ä»£æ›¿</li>
</ol>
<pre><code class="vue">&lt;script&gt;
import html2canvas from &quot;html2canvas&quot;;

export default {
  // è·å–å¯è§†åŒºåŸŸçš„å®½é«˜
  getClientSize() {
    const app = this.$refs.app;
    return [app.clientWidth, app.clientHeight];
  },
  // ç”Ÿæˆå›¾ç‰‡
  createPhoto() {
    const content = document.getElementById(&quot;container&quot;);
    const canvas = document.createElement(&quot;canvas&quot;);
    const [width, height] = this.getClientSize();
    const scale = 2;
    canvas.width = width;
    canvas.height = height;
    canvas.getContext(&quot;2d&quot;).scale(scale, scale);

    const opts = {
      logging: true, //  æ‰“å°ç”Ÿæˆå›¾ç‰‡çš„æ—¥å¿—
      canvas: canvas, //  å¯¼å…¥ç”Ÿæˆçš„canvas
      width: width,
      height: height,
      scale: scale,
      useCORS: true, //  å…è®¸å›¾ç‰‡è·¨åŸŸ
      timeout: 1000 //  è®¾ç½®å›¾ç‰‡è¶…æ—¶æ—¶é—´
    };
    html2canvas(content, opts).then(c =&gt; {
      this.photo = c.toDataURL(&quot;image/png&quot;, 1);
    });
  }
};
&lt;/script&gt;</code></pre>
<p>å®Œç¾~</p>
</li>
</ul>
<h2 id="å›¾ç‰‡å‹ç¼©"><a href="#å›¾ç‰‡å‹ç¼©" class="headerlink" title="å›¾ç‰‡å‹ç¼©"></a>å›¾ç‰‡å‹ç¼©</h2><p>å›¾ç‰‡å‹ç¼©æœ‰æˆ‘ä»¬ç†ŸçŸ¥çš„<u><a href="https://tinypng.com/" target="_blank" rel="noopener">ç†ŠçŒ«å‹ç¼©</a></u>ï¼Œè¿™ä¸ªåœ¨çº¿å‹ç¼©ç½‘ç«™å¯ä»¥æå¤§çš„å‡å°‘å›¾ç‰‡çš„å¤§å°åŒæ—¶ä¸ä¼šå‡ºç°å¤±çœŸï¼Œä½†å¯¹äºå·¥ç¨‹å¸ˆæ¥è¯´ï¼Œæ‹–å…¥æœ¬åœ°å›¾ç‰‡å‹ç¼©çš„åšæ³•æœªå…ç•¥æ˜¾è ¢ç¬¨ã€‚</p>
<p>äºæ˜¯ï¼Œæœ‰äº†è¿™ä¹ˆä¸€ä¸ªå›¾ç‰‡å‹ç¼©çš„å·¥å…·<code>imageMin</code>ï¼ŒåŠå…¶ webpack çš„æ‰©å±•<u><a href="https://github.com/Klathmon/imagemin-webpack-plugin" target="_blank" rel="noopener">imagemin-webpack-plugin</a></u>ã€‚</p>
<pre><code class="js">const ImageminPlugin = require(&#39;imagemin-webpack-plugin&#39;).default
const IS_PROD  = [&#39;production&#39;, &#39;prod&#39;].includes(process.env.NODE_ENV)  //  åˆ¤æ–­å½“å‰ç¯å¢ƒ

module.exports = {
  configureWebpack: {
    plugins: {
      new ImageminPlugin({
        disable: !IS_PROD,
        pngquant: {
          quality: &#39;80-100&#39;,  //  æ§åˆ¶å›¾ç‰‡è´¨é‡åŒºé—´
          progressive: true   //  å›¾ç‰‡åŠ è½½æ—¶çš„æ˜¾ç¤ºæ–¹å¼æ˜¯å¦æ˜¯æ¸å˜å‡ºç°
        }
      })
    }
  }
}</code></pre>
<p>äº²æµ‹å®ç”¨ï¼Œ<code>image</code>æ–‡ä»¶å¤¹åŸæœ¬ 5mb(å·²è¢« tinypng å‹ç¼©)ï¼Œæ‰“åŒ…ååªæœ‰ 3.5mbã€‚</p>

      </div>

      <div class="article-footer">
        
      </div>

      <div class="article-navs">
        
<nav class="card-container card-article-nav">
  <div class="card-wrap">
    
      <div id="article-nav-newer" class="card-item img">
        <article>
          
            <div class="card-cover" style="background-image: url(https://i.loli.net/2020/04/06/2pRIocJ8ibeyAMQ.jpg)"></div>
          
          <a class="card-link article-nav-link" href="/2019/09/19/agreeable/"></a>
          <strong class="article-nav-caption">Newer</strong>
          <p class="article-nav-title">
            
              æƒ¬æ„
            
          </p>
        </article>
      </div>
    
    
      <div id="article-nav-older" class="card-item img">
        <article>
          
            <div class="card-cover" style="background-image: url(https://i.loli.net/2020/04/05/yHEis5CFOdmDhBY.jpg)"></div>
          
          <a class="card-link article-nav-link" href="/2019/08/07/GFW/"></a>
          <strong class="article-nav-caption">Older</strong>
          <p class="article-nav-title">
            
              ä¸€åˆ†é’Ÿé€Ÿæˆç§‘å­¦ä¸Šç½‘æ•™å­¦
            
          </p>
        </article>
      </div>
    
  </div>
</nav>

      </div>
      
      

  
  
  <div class="valine-container">
    <div id="valine_thread" class="valine-thread"></div>
  </div>
  

  
  


    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
    <p>&copy; 2022 <a href="/" target="_blank">elegantYU</a></p>

    
      <p id="hitokoto"></p>
      <script src="https://v1.hitokoto.cn/?c=d&amp;encode=js&select=%23hitokoto" defer></script>
    

    

    <!-- <p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> Theme - <a href="https://github.com/miiiku/flex-block" target="_blank">flex-block</a></p> -->
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <div class="hiddenBox" style="display: none;">
      <span id="busuanzi_value_site_uv"></span>ä½é“å‹æ‹œè®¿è¿‡
      <span id="busuanzi_value_site_pv"></span>æ¬¡æµè¿å¿˜è¿”
      <span id="busuanzi_value_page_pv"></span>æ¬¡ç•™å
      <span id="busuanzi_container_site_uv"></span>
      <span id="busuanzi_container_site_pv"></span>
      <span id="busuanzi_container_page_pv"></span>
    </div>
  </div>
</footer>
  </div>

  
  
<!-- valine è¯„è®º start -->
<script type="text/javascript" src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script type="text/javascript" src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script type="text/javascript">
  new Valine({
    el: "#valine_thread",
    appId: "5xXAw8mGSxsiAVvItnDTlc1Q-gzGzoHsz",
    appKey: "izanFwv9WmbM99bQQKMDt6jj",
    avatar: "elegantYu",
    placeholder: "æˆ‘å¢æœ¬ä¼Ÿï¼æ²¡æœ‰å¼€æŒ‚ï¼",
    notify: true,
    visitor: true,
    pageSize: 10,
  });
</script>
<!-- valine è¯„è®º end -->



  <!-- aplayer éŸ³é¢‘ start -->
  <link rel="stylesheet" href="/lib/APlayer.min.css">
  <script src="/lib/APlayer.min.js"></script>
  <script type="text/javascript">
    const aplayer = document.querySelectorAll(".aplayer");
    aplayer && initaplayer(aplayer);
    function initaplayer(els) {
      let elsArr = Array.from(els);
      elsArr.forEach(el => {
        new APlayer({
          container: el,
          audio: { ...el.dataset },
          theme: "#b7daff",
          lrcType: 3,
          autoplay: false,
          loop: false,
          mutex: true,
        });
      });
    }
  </script>
  <!-- aplayer éŸ³é¢‘ end -->
  

<!-- dplayer è§†é¢‘ start -->
<link rel="stylesheet" href="/lib/DPlayer.min.css">
<script src="/lib/DPlayer.min.js"></script>
<script type="text/javascript">
  const dplayer = document.querySelectorAll(".dplayer");
  dplayer && initDPlayer(dplayer);
  function initDPlayer(els) {
    let elsArr = Array.from(els);
    elsArr.forEach(el => {
      let url = el.dataset.url;
      let cover = el.dataset.cover;
      new DPlayer({
        container: el,
        video: { url: url, pic: cover },
        theme: "#b7daff",
        autoplay: false,
        loop: false,
        mutex: true,
      });
    });
  }
</script>
<!-- dplayer è§†é¢‘ end -->


<!-- waterfall ç€‘å¸ƒæµ start -->
<script src="/lib/waterfall.min.js"></script>
<script type="text/javascript">

const waterfalls = document.querySelectorAll(".waterfall-container");

if (waterfalls && waterfalls.length > 0) {
  waterfalls.forEach((waterfall, index) => {
    let cls = "waterfall-container-" + index;
    waterfall.classList.add(cls);
    initWaterfall(cls, waterfall);
  });
}

function initWaterfall(selector, el) {
  const options = {};
  if (Object.keys(el.dataset).length > 0) {
    for (let k in el.dataset) {
      options[k] = el.dataset[k];
    }
  }
  waterfall(`.${selector}`, options);
}
</script>
<!-- waterfall ç€‘å¸ƒæµ end -->


  <!-- zoom start -->
  <script src="/lib/zoom.min.js"></script>
  <script type="text/javascript">
    document.querySelector(".article-content") && zoom(".article-content");
  </script>
  <!-- zoom end -->
  



  


  <!-- Google Analytics START -->
  <script type="text/javascript">
    (function (i, s, o, g, r, a, m) {
      if (window.location.hostname === "localhost" || window.location.hostname.startsWith("192.168")) {
        return console.log("æœ¬åœ°è°ƒè¯•");
      }
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
  
    ga('create', 'UA-165699409-1', 'auto');
    ga('send', 'pageview');
  </script>
  <!-- Google Analytics End -->

  


  



<script src="/js/script.js"></script>

<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@latest/build/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
  
  <!-- å°¾éƒ¨ç”¨æˆ·è‡ªå®šä¹‰ç›¸å…³å†…å®¹ -->

<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>